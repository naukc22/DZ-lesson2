# Packages Project

## Описание

Packages Project — это Java-приложение для управления посылками и траками, которое предоставляет пользователю несколько
способов взаимодействия: через REST API, Telegram-бот и консольный режим (Spring Shell). Приложение позволяет загружать
траки посылками с использованием различных стратегий, подсчитывать количество посылок в каждом траке, валидировать
входные данные и обрабатывать JSON-файлы.

Приложение работает с базой данных PostgreSQL, с поддержкой миграций Flyway. Тестовые данные накатываются через миграции
при инициализации базы.

## Основные функции

- **Загрузка посылок в траки** с использованием разных стратегий загрузки (например, `EFFECTIVE` и `BALANCED`).
- **Подсчёт количества посылок** в каждом траке.
- **Валидация входных данных**, таких как размеры посылок и траков.
- **Логирование операций** для мониторинга и отладки.
- **Работа с базой данных PostgreSQL**, включая автоматическое применение миграций Flyway.

## Способы взаимодействия

### 1. REST API

Приложение предоставляет REST API для взаимодействия с пользователем. Данные для запроса передаются либо в виде
параметров URL, либо в формате JSON в теле запроса. Ответы также приходят в формате JSON.

Примеры запросов:

- **Загрузка траков**:  
  `POST /api/load`  
  Данные посылаются в теле запроса в формате JSON. Ответ приходит в виде JSON с результатом загрузки.

- **Подсчёт посылок в траках**:  
  `GET /api/count`  
  Передача данных может происходить через параметры URL. Ответ в формате JSON возвращает количество посылок в каждом
  траке.

### 2. Telegram-бот

Приложение поддерживает взаимодействие через Telegram-бота. Пользователь может отправить файл с посылками в формате JSON
через чат с ботом и указать команду для выполнения (например, загрузка траков или подсчёт посылок). Результат в формате
JSON будет возвращен пользователю обратно в чат в виде файла.

Пример взаимодействия:

1. Отправьте команду для загрузки траков, прикрепив к сообщению JSON-файл с посылками.
2. Бот выполнит команду и вернёт вам результат в виде JSON-файла с загруженными траками или подсчитанными посылками.

### 3. Консоль (Spring Shell)

Также приложение поддерживает консольный режим через Spring Shell, где пользователю предлагается выбрать одну из опций:

1. Загрузить траки.
2. Подсчитать посылки в траках.
3. Выйти из приложения.

Программа принимает ввод от пользователя и выполняет соответствующую команду.

## Хранение посылок

Посылки в проекте хранятся в формате JSON. Каждый объект посылки содержит следующие поля:

- **name**: Название посылки (строка).
- **symbol**: Символ, который представляет посылку (символ).
- **form**: Двумерный массив строк, представляющий форму посылки.


### JSON формат для посылок 
```json
[
  {
    "name": "Холодильник",
    "symbol": "4",
    "form": [
      "44",
      "44"
    ]
  },
  {
    "name": "Байдарка",
    "symbol": "7",
    "form": [
      "7  ",
      "777"
    ]
  },
  {
    "name": "Телевизор",
    "symbol": "T",
    "form": [
      "TT",
      " T"
    ]
  }
]
```

### Пример ответа. JSON с загруженными траками

```json
[
  {
    "body": [
      "        ",
      "        ",
      "        ",
      "        ",
      "447  TT ",
      "44777 T ",
      "KKК4444 ",
      "КKK4444 "
    ],
    "loadedPackages": {
      "Холодильник": 3,
      "Телевизор": 1,
      "Байдарка": 1,
      "Кресло": 1
    }
  }
```

### Пример JSON файла для разгрузки

```json
[
  [
    "+        +",
    "+72244   +",
    "+77744   +",
    "++++++++++"
  ],
  [
    "+        +",
    "+        +",
    "+        +",
    "+        +",
    "+        +",
    "+222222  +",
    "++++++++++"
  ]
]
```

### Как запустить проект

Настройка с помощью Docker

Приложение использует PostgreSQL для хранения данных. Перед запуском убедитесь, что вы настроили переменные окружения.
Для этого создайте файл .env в корневой директории проекта (рядом с docker-compose.yml) и добавьте туда свои данные.

Пример файла .env:

# Данные для базы данных PostgreSQL

```
POSTGRES_DB=packages_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=yourpassword
```

# Данные для Telegram бота

```
TELEGRAM_BOT_NAME=parcels_liga_bot
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
```

Запустите контейнеры с помощью команды:

```
docker-compose up --build
```

### Миграции Flyway

Миграции для базы данных настроены с помощью Flyway. При запуске приложения автоматически применяются все миграции,
включая тестовые данные, которые используются для проверки и отладки.